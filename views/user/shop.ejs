<%- include ('layout/navbar.ejs') %>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

      <section class="breadcrumb-option">
            <div class="container">
                  <div class="row">
                        <div class="col-lg-12">
                              <div class="breadcrumb__text">
                                    <h4>Shop</h4>
                                    <div class="breadcrumb__links">
                                          <a href="/">Home</a>
                                          <span>Shop</span>
                                    </div>
                              </div>
                        </div>
                  </div>
            </div>
      </section>
      <section class="shop spad">
            <div class="container">
                  <div class="row">
                        <div class="col-lg-3">
                              <div class="shop__sidebar">
                                    <div class="shop__sidebar__accordion">
                                          <div class="accordion" id="accordionExample">
                                                <div class="card">
                                                      <div class="card-heading">
                                                            <a data-toggle="collapse"
                                                                  data-target="#collapseOne">Categories</a>
                                                      </div>

                                                      <div id="collapseOne" class="collapse show"
                                                            data-parent="#accordionExample">
                                                            <div class="card-body">

                                                                  <div class="shop__sidebar__categories">

                                                                        <ul class="nice-scroll">

                                                                              <% for( let i=0; i<category.length;i++){%>
                                                                                    <li><a onclick="CategoryMap('<%= category[i]._id %>')"
                                                                                                href="#">
                                                                                                <%=category[i].categoryName%>
                                                                                          </a>
                                                                                    </li>
                                                                                    <% } %>
                                                                        </ul>
                                                                  </div>
                                                            </div>
                                                      </div>
                                                </div>
                                          </div>
                                    </div>
                              </div>
                        </div>
                        <div class="col-lg-9">
                              <div class="shop__product__option">
                                    <div class="row">
                                          <div class="col-lg-6 col-md-6 col-sm-6">
                                                <div class="shop__product__option__left">
                                                      <p>Showing 1–12 of 126 results</p>
                                                </div>
                                          </div>
                                          <div class="col-lg-6 col-md-6 col-sm-6">
                                                <div class="shop__product__option__right">
                                                      <p>Sort by Price:</p>
                                                      <select>
                                                            <option value="">Low To High</option>
                                                            <option value="">$0 - $55</option>
                                                            <option value="">$55 - $100</option>
                                                      </select>
                                                </div>
                                          </div>
                                    </div>
                              </div>
                              <div id="MapProduct" class="row">
                                    <% for( let i=0; i < product.length; i++ ) { %>
                                          <div class="col-lg-4 col-md-6 col-sm-6">
                                                <div class="product__item">

                                                      <a href="/productdetail/<%= product[i]._id %> ">
                                                            <div class="product__item__pic set-bg" data-setbg=" ">
                                                                  <img src="<%= product[i].images[0].Location %>"
                                                                        alt="">
                                                                  <% if (user) { %>
                                                                        <ul class="product__hover">
                                                                              <li
                                                                                    id="wishlistButton<%= product[i]._id %>">
                                                                                    <a
                                                                                          onclick="addToWishlist('<%= product[i]._id %>')">
                                                                                          <i class="bi bi-heart"></i>
                                                                                    </a>
                                                                              </li>
                                                                        </ul>
                                                                        <% } %>
                                                            </div>
                                                      </a>

                                                      <div class="product__item__text">
                                                            <h6>
                                                                  <%= product[i].Product_title %>
                                                            </h6>
                                                            <div class="rating">
                                                                  <i class="fa fa-star-o"></i>
                                                                  <i class="fa fa-star-o"></i>
                                                                  <i class="fa fa-star-o"></i>
                                                                  <i class="fa fa-star-o"></i>
                                                                  <i class="fa fa-star-o"></i>
                                                            </div>
                                                            <div class="flex">
                                                                  <del><span class=" ">₹<%=
                                                                                    product[i].Price.Retail_price %>
                                                                        </span></del>
                                                                  <h5 class="ml-2">₹<%= product[i].Price.Offer_price %>
                                                                  </h5>
                                                            </div>

                                                            <div class="product__color__select">
                                                                  <label for="pc-4">
                                                                        <input type="radio" id="pc-4">
                                                                  </label>
                                                                  <label class="active black" for="pc-5">
                                                                        <input type="radio" id="pc-5">
                                                                  </label>
                                                                  <label class="grey" for="pc-6">
                                                                        <input type="radio" id="pc-6">
                                                                  </label>
                                                            </div>

                                                      </div>
                                                      <% if (user) { %>
                                                            <a onclick="addCart(`<%= product[i]._id %>`)"
                                                                  class="add-cart text-danger">+
                                                                  Add To
                                                                  Cart</a>
                                                            <% } %>
                                                </div>
                                          </div>
                                          <% } %>
                              </div>
                              <div class="row">
                                    <div class="col-lg-12">
                                          <div class="product__pagination">
                                                <a class="active" href="#">1</a>
                                                <a href="#">2</a>
                                                <a href="#">3</a>
                                                <span>...</span>
                                                <a href="#">21</a>
                                          </div>
                                    </div>
                              </div>
                        </div>
                  </div>
            </div>
      </section>
      <%- include ('layout/footer.ejs') %>


            <script>
                  let product;
                  const CategoryMap = (id) => {
                        axios.get("/userCategory", { params: { id: id } }).then((product) => {
                              document.getElementById("MapProduct").innerHTML = ""

                              let html = ``
                              console.log(product.data.product)

                              for (let i = 0; i < product.data.product.length; i++) {
                                    html += ` 
                                      <div class="col-lg-4 col-md-6 col-sm-6">
                                                <div class="product__item">
                                                      <a href="/productdetail/${product.data.product[i]._id} ">
                                                            <div class="product__item__pic set-bg" data-setbg=" ">
                                                                  <img src="${product.data.product[i].images[0].Location}"
                                                                        alt="">
                                                                  <ul class="product__hover">
                                                                        <li><a href="#"><img
                                                                                          src="/user/assets/img/icon/heart.png"
                                                                                          alt=""></a></li>

                                                                        <li><a href="#"><img
                                                                                          src="/user/assets/img/icon/search.png"
                                                                                          alt=""></a></li>
                                                                  </ul>
                                                            </div>
                                                      </a>

                                                      <div class="product__item__text">
                                                            <h6>
                                                                  ${product.data.product[i].Product_title}
                                                            </h6>
                                                            <div class="rating">
                                                                  <i class="fa fa-star-o"></i>
                                                                  <i class="fa fa-star-o"></i>
                                                                  <i class="fa fa-star-o"></i>
                                                                  <i class="fa fa-star-o"></i>
                                                                  <i class="fa fa-star-o"></i>
                                                            </div>
                                                            <div class="flex">
                                                                  <del><span class=" ">₹${product.data.product[i].Price.Retail_price}
                                                                        </span></del>
                                                                  <h5 class="ml-2">₹${product.data.product[i].Price.Offer_price}
                                                                  </h5>
                                                            </div>

                                                            <div class="product__color__select">
                                                                  <label for="pc-4">
                                                                        <input type="radio" id="pc-4">
                                                                  </label>
                                                                  <label class="active black" for="pc-5">
                                                                        <input type="radio" id="pc-5">
                                                                  </label>
                                                                  <label class="grey" for="pc-6">
                                                                        <input type="radio" id="pc-6">
                                                                  </label>
                                                            </div>

                                                      </div>
                                                      <a href="/cart" class="add-cart">+ Add To Cart</a>
                                                </div>


                                          </div>`
                              }
                              document.getElementById("MapProduct").innerHTML = html;




                        })
                  }


                  const addToWishlist = (id) => {
                        axios.post("/addToCart", { id }).then((e) => {
                              if (e.data.response == true) {
                                    const Toast = Swal.mixin({
                                          toast: true,
                                          position: 'top-end',
                                          showConfirmButton: false,
                                          timer: 1000,
                                          timerProgressBar: true,
                                          didOpen: (toast) => {
                                                toast.addEventListener('mouseenter', Swal.stopTimer)
                                                toast.addEventListener('mouseleave', Swal.resumeTimer)
                                          }
                                    })

                                    Toast.fire({
                                          icon: 'success',
                                          title: 'Add to Wishlist',
                                    })
                                    document.getElementById("wishlistButton" + id).innerHTML = ` <a>
                                                                                          <i class="bi bi-heart-fill"></i>
                                                                                    </a>`}
                              else {
                                    const Toast = Swal.mixin({
                                          toast: true,
                                          position: 'top-end',
                                          showConfirmButton: false,
                                          timer: 1500,
                                          timerProgressBar: true,
                                          didOpen: (toast) => {
                                                toast.addEventListener('mouseenter', Swal.stopTimer)
                                                toast.addEventListener('mouseleave', Swal.resumeTimer)
                                          }
                                    })

                                    Toast.fire({
                                          icon: 'info',
                                          title: 'Item Already Exist!',
                                    })
                              }
                        })
                  }
                  const addCart = (id) => {
                        axios.post("/addCart", { id: id }).then((e) => {
                              if (e.data.response) {
                                    const Toast = Swal.mixin({
                                          toast: true,
                                          position: 'top-end',
                                          showConfirmButton: false,
                                          timer: 1000,
                                          timerProgressBar: true,
                                          didOpen: (toast) => {
                                                toast.addEventListener('mouseenter', Swal.stopTimer)
                                                toast.addEventListener('mouseleave', Swal.resumeTimer)
                                          }
                                    })

                                    Toast.fire({
                                          icon: 'success',
                                          title: 'Item Added to cart',
                                    })
                              }
                        })

                  }

            </script>